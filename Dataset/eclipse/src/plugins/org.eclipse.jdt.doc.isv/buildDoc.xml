<?xml version="1.0" encoding="UTF-8"?>
<project name="Jdt Doc Isv Build" default="all"  basedir="." >

<target name="init">
	<available file="${basedir}/doc.zip" property="doc.zip.present"/>
</target>
	
<target name="all" depends="init" unless="doc.zip.present">
	<antcall target="convertSchemaToHtml" />
	<antcall target="examplesDocCopy" />
	<antcall target="generateJavadoc" />
	<antcall target="build.index" />
	<antcall target="createDocZip" />
</target>


<target name="build.index" description="Builds search index for the plug-in: org.eclipse.jdt.doc.isv" if="eclipse.running">
	<help.buildHelpIndex manifest="${basedir}/plugin.xml" destination="${basedir}"/>
</target>

<target name="convertSchemaToHtml" if="eclipse.running">
	<property name="dest" value="reference/extension-points" />
	    <record name="${basedir}/jdtconvert.txt" action="start"/>
   
	    <pde.convertSchemaToHTML manifest="../org.eclipse.jdt.core/plugin.xml" destination="${dest}" />
		<pde.convertSchemaToHTML manifest="../org.eclipse.jdt.debug/plugin.xml" destination="${dest}" />
   	    <pde.convertSchemaToHTML manifest="../org.eclipse.jdt.debug.ui/plugin.xml" destination="${dest}" />
	    <pde.convertSchemaToHTML manifest="../org.eclipse.jdt.junit/plugin.xml" destination="${dest}" />
	    <pde.convertSchemaToHTML manifest="../org.eclipse.jdt.launching/plugin.xml" destination="${dest}" />
	    <pde.convertSchemaToHTML manifest="../org.eclipse.jdt.ui/plugin.xml" destination="${dest}" />
	
	    <record name="${basedir}/jdtconvert.txt" action="stop"/>
</target>

<target name="examplesDocCopy" >
	 <copy todir="samples">
    	<fileset dir="..">
    		<include name="org.eclipse.jdt.ui.examples.projects/doc-html/"/>
	    </fileset>
	  </copy>
</target>


<target name="getJavadocPath">
	<available file="${java.home}/../bin/javadoc.exe" property="javadoc" value="${java.home}/../bin/javadoc.exe"/>
	<available file="${java.home}/../bin/javadoc" property="javadoc" value="${java.home}/../bin/javadoc" />
</target>


<target name="generateJavadoc" depends="getJavadocPath" if="javadoc">

	<!--HACK to ensure the platform doc is built before JDT - call to this script should be moved to build.jars target-->
	<available file="../org.eclipse.platform.doc.isv/doc.zip" property="platform.doc.zip.present"/>
	<antcall target="buildPlatformDoc" />

	<condition property="optionsFile" value="jdtOptions">
	      <os family="unix" />
    </condition>
    <condition property="optionsFile" value="jdtOptions.txt">
	      <os family="windows" />
    </condition>

	<replace file="${basedir}/${optionsFile}" token="@rt@" value="${bootclasspath}" />

		
	<!--scrub isv plugin directories of any preexisting api doc content-->
	<delete dir="reference/api"/>
	<mkdir dir="reference/api"/>

	<exec dir="." executable="${javadoc}" output="doc.bin.log">
		<arg line="@${basedir}/${optionsFile} -J-Xmx500M" />
	</exec>
</target>

<target name="buildPlatformDoc" unless="platform.doc.zip.present">
	<ant antfile="buildDoc.xml" dir="../org.eclipse.platform.doc.isv" />
</target>

<target name="createDocZip">
	<zip zipfile="${basedir}/doc.zip"
		basedir="${basedir}"
		includes="book.css, cpy.png, notices.html, about.html, no_help_exists.htm, concepts/**, gettingStarted/**, images/**, reference/**, tasks/**,samples/**,guide/**,questions/**"
	/>
</target>

</project>














